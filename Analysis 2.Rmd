```{r}
# Load necessary libraries
library(dplyr)

data <- read.csv(file.choose())
```

```{r}
summary(data)
```

```{r}
sf_columns <- c("LotFrontage", "LotArea", "BsmtFinSF1", "BsmtFinSF2", 
                "BsmtUnfSF", "TotalBsmtSF", "1stFlrSF", "2ndFlrSF", 
                "LowQualFinSF", "GrLivArea", "GarageArea", "WoodDeckSF", 
                "OpenPorchSF", "EnclosedPorch", "3SsnPorch", 
                "ScreenPorch", "PoolArea")

for (col in sf_columns) {
  if (col %in% colnames(data)) {
    data[[col]] <- data[[col]] / 100
  }
}

```
```{r}
summary(data)
```


```{r}

# Load necessary library
library(ggplot2)

# Filter numerical variables (excluding SalePrice)
numerical_cols <- sapply(data, is.numeric) # Identify numeric columns
numerical_data <- data[, numerical_cols]
numerical_data <- numerical_data[, colnames(numerical_data) != "SalePrice"] # Exclude SalePrice

# Create and display scatterplots for each numerical variable vs SalePrice
for (col in colnames(numerical_data)) {
  p <- ggplot(data, aes_string(x = col, y = "SalePrice")) +
    geom_point(alpha = 0.5) +
    labs(title = paste("SalePrice vs", col), x = col, y = "SalePrice") +
    theme_minimal()
  
  # Explicitly print the plot within the loop
  print(p)
}
```

```{r}
# ---------------------------------
# Step 1: Handle Missing Values
# ---------------------------------

# 1. Identify numerical and categorical columns
num_cols <- sapply(data, is.numeric) # Logical vector for numeric columns
cat_cols <- sapply(data, is.character) # Logical vector for categorical columns

# 2. Handle missing values in numerical columns
# Replace NA in numerical columns with the median of each column
data[num_cols] <- lapply(data[num_cols], function(x) ifelse(is.na(x), median(x, na.rm = TRUE), x))

# 3. Handle missing values in categorical columns
# Replace NA in categorical columns with "None"
data[cat_cols] <- lapply(data[cat_cols], function(x) ifelse(is.na(x), "None", x))
```


```{r}
# ---------------------------------
# Step 2: Verify Data Cleaning
# ---------------------------------

# Check for any remaining missing values
missing_values <- sum(is.na(data))
if (missing_values == 0) {
  print("All missing values have been handled successfully!")
} else {
  print(paste("Remaining missing values:", missing_values))
}
```
```{r}
write.csv(data, file="cleaned_house_data.csv")
```

```{r}
numeric_data <- data %>% select(where(is.numeric))
```

```{r}
numeric_data <- numeric_data[, !names(numeric_data) %in% "Id"]

#write.csv(numeric_data, "num_house.csv", row.names = FALSE)
```

```{r}
numeric_data
```


```{r}
model1 <- lm(SalePrice ~ GrLivArea, data = numeric_data)
```

```{r}
model2 <- lm(SalePrice ~ GrLivArea + FullBath, data = numeric_data)
```

```{r}
model3 <- lm(SalePrice ~ LotArea + OverallQual + OverallCond + YearBuilt + YearRemodAdd + MasVnrArea + BsmtFinSF1 + TotalBsmtSF + GrLivArea + BedroomAbvGr + KitchenAbvGr + TotRmsAbvGrd + GarageCars + WoodDeckSF, data = numeric_data)
```

```{r}
summary(model1)$adj.r.squared
summary(model2)$adj.r.squared
summary(model3)$adj.r.squared

```

```{r}
test_data = read.csv(file.choose())
```

```{r}
# Load necessary libraries
library(dplyr)


# Check for missing values
missing_summary <- colSums(is.na(test_data))
print("Summary of Missing Values Before Fixing:")
print(missing_summary)

# Handle missing values
# 1. Replace missing numerical values with the median
num_cols <- sapply(test_data, is.numeric)
test_data[num_cols] <- lapply(test_data[num_cols], function(x) {
  ifelse(is.na(x), median(x, na.rm = TRUE), x)
})

# 2. Replace missing categorical values with "None"
cat_cols <- sapply(test_data, is.character)
test_data[cat_cols] <- lapply(test_data[cat_cols], function(x) {
  ifelse(is.na(x), "None", x)
})

# Verify no missing values remain
missing_summary_after <- colSums(is.na(test_data))
print("Summary of Missing Values After Fixing:")
print(missing_summary_after)

```

```{r}
for (col in sf_columns) {
  if (col %in% colnames(test_data)) {
    test_data[[col]] <- test_data[[col]] / 100
  }
}
```

```{r}
head(test_data)
```

```{r}
numeric_data_test <- test_data %>% select(where(is.numeric))
```

```{r}
summary(numeric_data)
```

```{r}
summary(numeric_data_test)
```

```{r}
predictions3 <- predict(model3, newdata = test_data)
adjusted_predictions3 <- ifelse(predictions3 > 0, predictions3, 10000)
# For Model 3: Adjust predictions and handle NA values
adjusted_predictions3 <- ifelse(is.na(predictions3) | predictions3 <= 0, 10000, predictions3)
results3 <- data.frame(
  Id = test_data$Id,
  SalePrice = adjusted_predictions3
)
```

```{r}
head(results3)
```
```{r}
write.csv(results3, "results.csv", row.names = FALSE)
```


```{r}
# Generate predictions for the models
predictions1 <- predict(model1, newdata = test_data)
predictions2 <- predict(model2, newdata = test_data)
predictions3 <- predict(model3, newdata = test_data)

# Apply the logic to ensure SalePrice is never less than 10,000
# Model 1
adjusted_predictions1 <- ifelse(predictions1 > 0, predictions1, 10000)

# Model 2
adjusted_predictions2 <- ifelse(predictions2 > 0, predictions2, 10000)

# Model 3
adjusted_predictions3 <- ifelse(predictions3 > 0, predictions3, 10000)
```


```{r}
# For Model 3: Adjust predictions and handle NA values
adjusted_predictions3 <- ifelse(is.na(predictions3) | predictions3 <= 0, 10000, predictions3)
results3 <- data.frame(
  Id = test_data$Id,
  SalePrice = adjusted_predictions3
)
```


```{r}
results3
```

```{r}
write.csv(results3, "results.csv", row.names = FALSE)
```





